// // Ð²Ñ…Ð¾Ð´Ð½Ð°Ñ Ñ‚Ð¾Ñ‡ÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
require("dotenv").config();
const { Telegraf } = require("telegraf");

const bot = new Telegraf(process.env.BOT_TOKEN);

// ðŸ‘‰ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
require("./src/commands/clientFree")(bot);
require("./src/commands/clientPay")(bot);
require("./src/commands/admin")(bot);

// â”€â”€ Ð·Ð°Ð¿ÑƒÑÐº
bot.launch();

process.once("SIGINT", () => bot.stop("SIGINT"));
process.once("SIGTERM", () => bot.stop("SIGTERM"));

// require("dotenv").config();
// const { Telegraf } = require("telegraf");
// const axios = require("axios");

// const bot = new Telegraf(process.env.BOT_TOKEN);

// const ADMIN_ID = process.env.ADMIN_ID; // ÐŸÑ€Ð¾Ð¿Ð¸ÑˆÐ¸ ÑÐ²Ð¾Ð¹ Telegram ID Ð² .env

// // ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ
// bot.start((ctx) => {
//   ctx.reply(
//     `ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð¯ â€” AstroBot ðŸŒŸ\n\nÐ§Ñ‚Ð¾Ð±Ñ‹ Ñ ÑÐ¾ÑÑ‚Ð°Ð²Ð¸Ð» Ñ‚Ð²Ð¾ÑŽ Ð½Ð°Ñ‚Ð°Ð»ÑŒÐ½ÑƒÑŽ ÐºÐ°Ñ€Ñ‚Ñƒ, Ð¿Ñ€Ð¸ÑˆÐ»Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ:\n\nðŸ“… Ð”Ð”.ÐœÐœ.Ð“Ð“Ð“Ð“ â° Ð§Ð§:ÐœÐœ ðŸ—ºï¸ Ð“Ð¾Ñ€Ð¾Ð´\n\nÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: 01.01.2000 10:00 ÐœÐ¾ÑÐºÐ²Ð°\n\nâœ¨ Ð§Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ·Ð½Ð°Ñ‚ÑŒ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ¾Ð¼ â€” Ð²Ð²ÐµÐ´Ð¸ /compat`
//   );
// });

// // ÐÐ°Ñ‚Ð°Ð»ÑŒÐ½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð° (Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð°Ñ)
// bot.hears(/^\d{2}\.\d{2}\.\d{4}\s+\d{2}:\d{2}\s+.+$/, async (ctx) => {
//   const userInput = ctx.message.text.trim();
//   ctx.reply("ðŸ”­ Ð¡Ð¾ÑÑ‚Ð°Ð²Ð»ÑÑŽ ÐºÐ°Ñ€Ñ‚Ñƒ Ð·Ð²Ñ‘Ð·Ð´...");

//   const systemPrompt = `Ð¡Ð¾ÑÑ‚Ð°Ð²ÑŒ ÐºÑ€Ð°Ñ‚ÐºÑƒÑŽ Ð½Ð°Ñ‚Ð°Ð»ÑŒÐ½ÑƒÑŽ ÐºÐ°Ñ€Ñ‚Ñƒ Ð´Ð»Ñ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°, Ñ€Ð¾Ð´Ð¸Ð²ÑˆÐµÐ³Ð¾ÑÑ ${userInput}. Ð£ÐºÐ°Ð¶Ð¸:

// â˜€ï¸ Ð¡Ð¾Ð»Ð½Ñ†Ðµ â€” Ð·Ð½Ð°Ðº Ð¸ ÐµÐ³Ð¾ Ð²Ð»Ð¸ÑÐ½Ð¸Ðµ
// ðŸŒ™ Ð›ÑƒÐ½Ð° â€” Ð·Ð½Ð°Ðº Ð¸ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸
// ðŸ§  ÐœÐµÑ€ÐºÑƒÑ€Ð¸Ð¹ â€” ÑÑ‚Ð¸Ð»ÑŒ Ð¼Ñ‹ÑˆÐ»ÐµÐ½Ð¸Ñ
// ðŸ”¥ ÐœÐ°Ñ€Ñ â€” ÑÐ½ÐµÑ€Ð³Ð¸Ñ Ð¸ Ð¼Ð¾Ñ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ

// ÐÐµ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð¹ Ð»ÑŽÐ±Ð¾Ð²ÑŒ, ÑÐµÐºÑ, Ð´ÐµÐ½ÑŒÐ³Ð¸, Ñ„Ð¸Ð½Ð°Ð½ÑÑ‹, ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ, Ð²ÐµÐ½ÐµÑ€Ñƒ Ð¸ 12 Ð´Ð¾Ð¼. Ð“Ð¾Ð²Ð¾Ñ€Ð¸ Ñ‚ÐµÐ¿Ð»Ð¾, Ð¿Ð¾-Ð´Ñ€ÑƒÐ¶ÐµÑÐºÐ¸, Ð±ÐµÐ· ÑÐ·Ð¾Ñ‚ÐµÑ€Ð¸ÐºÐ¸. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÑÐ¼Ð°Ð¹Ð»Ð¸ÐºÐ¸, Ð³Ð¾Ð²Ð¾Ñ€Ð¸ ÐºÑ€Ð°Ñ‚ÐºÐ¾ Ð¸ ÑÑƒÑ‚ÑŒ.

// Ð’ ÐºÐ¾Ð½Ñ†Ðµ Ð´Ð¾Ð±Ð°Ð²ÑŒ Ð²Ñ‹Ð²Ð¾Ð´ Ð² Ñ‚Ð°ÐºÐ¾Ð¼ ÑÑ‚Ð¸Ð»Ðµ:
// â€”
// âœ¨ Ð’ Ð¸Ñ‚Ð¾Ð³Ðµ: ... (Ð³Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ð¸Ñ‚Ð¾Ð³ Ð¾ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐµ)
// `;

//   try {
//     const response = await axios.post(
//       "https://openrouter.ai/api/v1/chat/completions",
//       {
//         model: "openai/gpt-3.5-turbo",
//         messages: [
//           {
//             role: "system",
//             content:
//               "Ð¢Ñ‹ Ð°ÑÑ‚Ñ€Ð¾Ð»Ð¾Ð³, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ð¸ÑˆÐµÑ‚ Ð¿Ð¾-Ñ‡ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÑÐºÐ¸. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑˆÑŒ ÑÐ¼Ð°Ð¹Ð»Ð¸ÐºÐ¸, Ð¿Ð¸ÑˆÐ¸ ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð² Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð¼ ÑˆÐ°Ð±Ð»Ð¾Ð½Ðµ.",
//           },
//           { role: "user", content: systemPrompt },
//         ],
//       },
//       {
//         headers: {
//           Authorization: `Bearer ${process.env.OPENROUTER_API_KEY}`,
//           "HTTP-Referer": `https://t.me/${process.env.BOT_USERNAME}`,
//           "Content-Type": "application/json",
//         },
//       }
//     );

//     const output =
//       response.data.choices?.[0]?.message?.content?.trim() ||
//       "ðŸŒŒ Ð—Ð²Ñ‘Ð·Ð´Ñ‹ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð¼Ð¾Ð»Ñ‡Ð°Ñ‚. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ Ð¿Ð¾Ð·Ð¶Ðµ.";

//     ctx.reply(output);
//   } catch (error) {
//     console.error("âŒ OpenRouter API Error:", error.response?.data || error.message);
//     ctx.reply("ðŸ› ï¸ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸ Ðº Ð·Ð²Ñ‘Ð·Ð´Ð°Ð¼. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ ÐµÑ‰Ñ‘ Ñ€Ð°Ð· Ð¿Ð¾Ð·Ð¶Ðµ.");
//   }
// });

// // ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° /compat â€” Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ Ð¿Ð¾ Ð¾Ð¿Ð»Ð°Ñ‚Ðµ
// bot.command("compat", async (ctx) => {
//   ctx.reply(
//     "ðŸ’³ Ð”Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÑŒ 10â‚½ Ð½Ð° ÐºÐ°Ñ€Ñ‚Ñƒ:\n\n2202 2006 1234 5678\n\nÐ—Ð°Ñ‚ÐµÐ¼ Ð¿Ñ€Ð¸ÑˆÐ»Ð¸ ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚ Ð¸Ð»Ð¸ Ñ‡ÐµÐº ÑÑŽÐ´Ð° ðŸ‘‡"
//   );
// });

// // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ñ‡ÐµÐºÐ° (Ñ„Ð¾Ñ‚Ð¾, Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ Ð¸ Ñ‚.Ð¿.)
// bot.on(["photo", "document"], async (ctx) => {
//   const user = ctx.from;

//   // Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÑÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
//   await ctx.reply("ðŸ“© ÐŸÑ€Ð¸Ð½ÑÑ‚Ð¾. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŽ Ñ‡ÐµÐº Ð¸ Ð¾Ñ‚ÐºÑ€Ð¾ÑŽ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ð¿Ñ€Ð¸ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ð¸.");

//   // ÐŸÐµÑ€ÐµÑÑ‹Ð»Ð°ÐµÐ¼ Ð°Ð´Ð¼Ð¸Ð½Ñƒ Ñ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÐµÐ¹
//   await ctx.forwardMessage(ADMIN_ID);

//   await bot.telegram.sendMessage(
//     ADMIN_ID,
//     `ðŸ§¾ ÐÐ¾Ð²Ñ‹Ð¹ Ñ‡ÐµÐº Ð¾Ñ‚ @${user.username || "Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚ÐµÐ½"} (ID: ${user.id})\nÐžÑ‚Ð²ÐµÑ‚ÑŒ Ð½Ð° ÑÑ‚Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹ /grant`
//   );
// });

// // /grant â€” Ñ€ÑƒÑ‡Ð½Ð¾Ðµ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ Ð°Ð´Ð¼Ð¸Ð½Ð°
// bot.command("grant", async (ctx) => {
//   const replied = ctx.message.reply_to_message;

//   if (!replied || !replied.forward_from) {
//     return ctx.reply("âš ï¸ ÐžÑ‚Ð²ÐµÑ‚ÑŒ Ð½Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ ÑŽÐ·ÐµÑ€Ð°, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼Ñƒ Ð½Ð°Ð´Ð¾ Ð²Ñ‹Ð´Ð°Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿.");
//   }

//   const userId = replied.forward_from.id;

//   await bot.telegram.sendMessage(
//     userId,
//     "âœ… ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð°!\n\nÐŸÑ€Ð¸ÑˆÐ»Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð²ÑƒÑ… Ð»ÑŽÐ´ÐµÐ¹ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ:\n\nðŸ“… Ð”Ð”.ÐœÐœ.Ð“Ð“Ð“Ð“ â° Ð§Ð§:ÐœÐœ ðŸ—ºï¸ Ð“Ð¾Ñ€Ð¾Ð´ & ðŸ“… Ð”Ð”.ÐœÐœ.Ð“Ð“Ð“Ð“ â° Ð§Ð§:ÐœÐœ ðŸ—ºï¸ Ð“Ð¾Ñ€Ð¾Ð´"
//   );

//   await ctx.reply("âœ… Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ð²Ñ‹Ð´Ð°Ð½.");
// });

// bot.launch();

// process.once("SIGINT", () => bot.stop("SIGINT"));
// process.once("SIGTERM", () => bot.stop("SIGTERM"));
