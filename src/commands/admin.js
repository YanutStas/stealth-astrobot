// src/commands/admin.js
// –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è / –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è —á–µ–∫–∞

const { DateTime } = require("luxon");
const logger = require("../logger");

module.exports = (bot) => {
  // callback: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –æ–ø–ª–∞—Ç—É
  bot.action(/^grant_ok_(\d+)$/, async (ctx) => {
    const userId = ctx.match[1];
    await ctx.answerCbQuery("–û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ ‚úîÔ∏è");

    // üëâ –ø–∏—à–µ–º –ª–æ–≥
    logger.info(
      {
        action: "grant_ok",
        targetId: userId,
        at: DateTime.local().setZone("Europe/Moscow").toISO(),
      },
      "‚úÖ –ê–¥–º–∏–Ω –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –æ–ø–ª–∞—Ç—É"
    );

    // —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await bot.telegram.sendMessage(
      userId,
      "‚ú® –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞!\n\n–°—É–ø–µ—Ä, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–∞–º–æ–º—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–º—É. " +
        "–ü—Ä–∏—à–ª–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–∞–Ω–Ω—ã–µ –¥–≤—É—Ö –Ω–∞—Ç–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É:\n\n" +
        "‚Ä¢ –¢–≤–æ–∏: üìÖ –î–î.–ú–ú.–ì–ì–ì–ì ‚è∞ –ß–ß:–ú–ú üó∫Ô∏è –ì–æ—Ä–æ–¥\n" +
        "‚Ä¢ –ü–∞—Ä—Ç–Ω—ë—Ä–∞: üìÖ –î–î.–ú–ú.–ì–ì–ì–ì ‚è∞ –ß–ß:–ú–ú üó∫Ô∏è –ì–æ—Ä–æ–¥\n\n" +
        "–ù–∞–ø—Ä–∏–º–µ—Ä:\n" +
        "`10.04.1995 09:30 –°–º–æ–ª–µ–Ω—Å–∫ & 25.12.1996 14:45 –ö–∞–∑–∞–Ω—å`\n\n" +
        "–ò —è —Å—Ä–∞–∑—É —Ä–∞—Å—Å–∫–∞–∂—É, –∫–∞–∫ –∑–≤—ë–∑–¥—ã –≤–∏–¥—è—Ç –≤–∞—à—É —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å üòâ",
      { parse_mode: "Markdown" }
    );

    // –æ—Ç–º–µ—á–∞–µ–º –≤ —á–∞—Ç–µ –∞–¥–º–∏–Ω–∞
    await ctx.editMessageText("‚úÖ –û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø –≤—ã–¥–∞–Ω.");
  });

  // callback: –æ—Ç–∫–ª–æ–Ω—è–µ–º –æ–ø–ª–∞—Ç—É
  bot.action(/^grant_no_(\d+)$/, async (ctx) => {
    const userId = ctx.match[1];
    await ctx.answerCbQuery("–û–ø–ª–∞—Ç–∞ –ù–ï –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞");

    // –ª–æ–≥
    logger.info(
      {
        action: "grant_no",
        targetId: userId,
        at: DateTime.local().setZone("Europe/Moscow").toISO(),
      },
      "‚ùå –ê–¥–º–∏–Ω –æ—Ç–∫–ª–æ–Ω–∏–ª —á–µ–∫"
    );

    // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await bot.telegram.sendMessage(
      userId,
      "üòî –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–ª–∞—Ç—ë–∂ –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω. " +
        "–ü—Ä–æ–≤–µ—Ä—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –∏ –ø—Ä–∏—à–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–µ–∫ ‚Äî –∏ —è —Å—Ä–∞–∑—É –ø—Ä–æ–¥–æ–ª–∂—É."
    );

    await ctx.editMessageText("‚ùå –û–ø–ª–∞—Ç–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞.");
  });
};
